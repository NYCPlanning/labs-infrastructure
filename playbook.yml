---
- hosts: all
  become: true
  vars:
    users:
      - afeld
      - allthesignals
      - andycochran
      - chriswhong
    former_users: []
  handlers:
    - name: Restart SSH
      service:
        name: ssh
        state: restarted
  tasks:
    - name: Set up users
      include_tasks: tasks/user.yml
      loop: "{{ users }}"
    - name: Remove former users
      user:
        name: "{{ item }}"
        state: absent
      loop: "{{ former_users }}"
    - name: Disallow root SSH access
      lineinfile:
        dest: /etc/ssh/sshd_config
        regexp: ^PermitRootLogin
        line: PermitRootLogin no
      notify: Restart SSH
